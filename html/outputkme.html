<!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiRW (Sistem Informasi Rukun Warga)</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <style>
/* Mengimpor font dari Google Fonts */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap');

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Arial, sans-serif;
    min-height: 100vh;
    background-color: #ffffff;
    display: block; /* Menghilangkan display flex agar konten tidak berjejer */
}

/* Mengimpor font dari Google Fonts */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap');

/* Styling untuk header */
.header {
    background: linear-gradient(45deg, #FF6F61, #FFB6C1, #FDCB82, #F49AC2, #FF8C94); /* Efek gradient bergerak */
    background-size: 400% 400%; /* Efek gradient yang lebih besar */
    animation: gradientAnimation 10s ease infinite; /* Animasi gradien bergerak */
    padding: 10px 20px;
    text-align: center;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    border-radius: 12px;
    margin-bottom: 0px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    position: relative;
}

/* Animasi untuk latar belakang gradient */
@keyframes gradientAnimation {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* Styling untuk h1 di dalam header */
.header h1 {
    font-family: 'Poppins', sans-serif;
    font-size: 35px;
    font-weight: 600;
    color: white;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin: 0;
    text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);
    animation: textAnimation 2s ease forwards; /* Animasi teks muncul */
}

/* Animasi teks */
@keyframes textAnimation {
    0% {
        transform: translateY(-50px);
        opacity: 0;
    }
    100% {
        transform: translateY(0);
        opacity: 1;
    }
}

/* Efek hover pada ikon dan teks */
.header:hover .header-icon {
    transform: rotate(360deg); /* Memutar ikon */
}

.header:hover h1 {
    color: #FFFBF0; /* Warna teks berubah saat hover */
    transform: scale(1.05); /* Teks sedikit membesar */
    transition: transform 0.3s ease, color 0.3s ease; /* Transisi mulus */
}

/* Styling responsif untuk header */
@media (max-width: 768px) {
    .header h1 {
        font-size: 36px; /* Ukuran font lebih kecil di layar kecil */
    }


}

/* Layout utama */
.layout {
    display: flex;
    flex: 1;
    margin-top: 20px; /* Memberikan ruang setelah header */
}

/* Sidebar */
.sidebar {
    width: 250px;
    background-color: #e0f0ff;
    padding: 20px;
    box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
}

.sidebar img {
    width: 50px;
    height: 50px;
}

.sidebar h2 {
    font-size: 24px;
    margin: 10px 0;
}

.sidebar h3 {
    font-size: 18px;
    margin: 20px 0 10px;
    color: #888;
}

.sidebar ul {
    list-style: none;
    padding: 0;
}

.sidebar ul li {
    margin: 10px 0;
}

.sidebar ul li a {
    text-decoration: none;
    color: #333;
    display: flex;
    align-items: center;
}

.sidebar ul li a i {
    margin-right: 10px;
}

.sidebar ul li a.active {
    background-color: #007bff;
    color: #fff;
    padding: 10px;
    border-radius: 5px;
}

/* Main Content */
.main-content {
    flex: 1;
    padding: 20px;
    margin-top: 30px;
}

/* Form */
.form-container {
    background-color: #e0f0ff;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    display: flex;
}

/* Form elements */
.biodata-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.profile-picture {
    margin-top: 5px;
    margin-bottom: 10px;
}

.form-content {
    flex: 3;
    margin-left: 20px;
}

.form-content h2 {
    margin-bottom: 20px;
    color: #333;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
}
/* Mengatur lebar textarea khusus untuk alamat */
#alamat {
    width: 100%; /* Mengatur lebar khusus untuk textarea alamat */
    max-width: 100%; /* Menambahkan batas maksimal lebar */
    height: 60px; /* Menyesuaikan tinggi textarea */
}

/* Styling untuk textarea lainnya */
#alamat-lengkap {
    width: 100%; /* Menyesuaikan ukuran dengan yang lainnya */
    margin: 0 auto;
    display: block;
    height: 60px; 
}



.form-group textarea {
    resize: none;
    height: 100px;
}

.form-group input[type="date"] {
    padding: 7px;
}

.form-row {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
}

.form-row .form-group {
    flex: 1;
    min-width: 200px;
}
.btn-back {
            display: inline-block;
            margin-bottom: 20px;
            color: #fff;
            background-color: #2196f3;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
        }
/* Tombol Kembali */
.btnn-back {
    background-color: #28a745; /* Warna hijau */
    color: white;
    padding: 10px 20px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s ease;
}

.btnn-back:hover {
    background-color: #5fe07d; /* Warna hijau gelap saat hover */
}

/* Menempatkan tombol di tengah */
.form-buttons {
    display: flex;
    justify-content: center; /* Menjaga tombol tetap di tengah */
    align-items: center; /* Menjaga tombol tetap vertikal di tengah */
    margin-top: 20px; /* Memberikan jarak dari konten form */
}

.section-title {
    background-color: #2196f3;
    color: #fff;
    padding: 5px;
    border-radius: 5px;
    margin-bottom: 10px;
    font-weight: bold;
}
.container {
            display: flex;
            height: calc(100vh - 50px);
        }

  </style>
</head>
<body>

        <!-- Header -->
        <div class="header">
            <h1>Sistem Informasi Rukun Warga</h1>
        </div>

    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="admin-section">
                <img alt="Admin Icon" height="50" src="https://storage.googleapis.com/a1aa/image/QbRvk1hbRfUzEq52sRqyXRWMFge5QZsdCYhtByAPYNkRJx2TA.jpg" width="50"/>
                <h2>Admin</h2>
            </div>
            <h3>MAIN</h3>
            <ul>
                <li>
                    <a href="#">
                        <i class="fas fa-home"></i>
                        Dashboard
                    </a>
                </li>
                <li>
                    <a class="active" href="#">
                        <i class="fas fa-user"></i>
                        Data Penduduk
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-file-alt"></i>
                        Surat Surat
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-comment"></i>
                        Saran
                    </a>
                </li>
            </ul>
            <h3>KELUAR</h3>
            <ul>
                <li>
                    <a href="#">
                        <i class="fas fa-sign-out-alt"></i>
                        Keluar
                    </a>
                </li>
            </ul>
        </div>
    
    
  <!-- Main Content -->
    <div class="main-content">
      <div class="form-container">


        <div class="biodata-container">
          <h2>Foto Identitas Resmi</h2>
          <div class="profile-picture">
              <img id="kk-preview-output" src="https://img.jakpost.net/c/2023/11/24/2023_11_24_144671_1700807264._large.jpg" alt="Foto KK" width="400" onclick="document.getElementById('kk-file').click()">
              <input type="file" id="kk-file" accept="image/*" style="display: none;" onchange="updateImage('kk-file', 'kk-preview-output', 'kk-preview-img')">
          </div>
          <h2>Foto Tempat Tinggal</h2>
          <div class="profile-picture">
              <img id="house-preview-output" src="https://img.jakpost.net/c/2023/11/24/2023_11_24_144671_1700807264._large.jpg" alt="Foto Rumah" width="400" onclick="document.getElementById('house-file').click()">
              <input type="file" id="house-file" accept="image/*" style="display: none;" onchange="updateImage('house-file', 'house-preview-output', 'house-preview-img')">
          </div>
      </div>
      

        <div class="form-content">
          <a href="outputkm.html" class="btn-back">
            <i class="fas fa-arrow-left"></i>
            Kembali Ke daftar Penduduk
        </a>
             
          <div class="section-title">Biodata:</div>

 <!-- Row 1: NIK dan Nama Lengkap -->
 <div class="form-row">
<div class="form-group">
    <label for="nik">NIK</label>
    <input type="text" id="nik" name="nik" maxlength="16"readonly  oninput="validateNumber(this)" onblur="validateLength(this, 16)">
    <div id="error-message-nik" style="color: red; display: none;">NIK harus berisi 16 angka.</div>
</div>
    
<div class="form-group">
    <label for="nama">Nama Lengkap</label>
    <input type="text" id="nama" name="nama" placeholder="Nama Lengkap" required />
  </div>
</div>

<!-- Row 2: No KK dan Status dalam Keluarga -->
<div class="form-row">
    <div class="form-group">
        <label for="no-kk">No Kartu Keluarga</label>
        <input type="text" id="no-kk" name="no-kk" maxlength="16" readonly  oninput="validateNumber(this)" onblur="validateLength(this, 16)">
        <div id="error-message-no-kk" style="color: red; display: none;">No Kartu Keluarga harus berisi 16 angka.</div>
    </div>
    

  <div class="form-group">
    <label for="status-keluarga">Status dalam Keluarga</label>
    <select id="status-keluarga" name="status-keluarga">
      <option value="Kepala Keluarga">Kepala Keluarga</option>
      <option value="istri">Istri</option>
      <option value="anak">Anak</option>
      <option value="orang_tua">Orang Tua</option>
      <option value="orang_tua">Saudara</option>
    </select>
  </div>
</div>

<!-- Row 3: Agama dan Jenis Kelamin -->
<div class="form-row">
  <div class="form-group">
    <label for="agama">Agama</label>
    <select id="agama" name="agama">
      <option value="kristen">Kristen</option>
      <option value="islam">Islam</option>
      <option value="hindu">Hindu</option>
      <option value="katolik">Katolik</option>
      <option value="konghucu">Konghucu</option>
      <option value="budha">Buddha</option>
      <option value="lainnya">Lainnya</option>
    </select>
  </div>
  <div class="form-group">
    <label for="jenis-kelamin">Jenis Kelamin</label>
    <select id="jenis-kelamin" name="jenis-kelamin">
      <option value="laki-laki">Laki-Laki</option>
      <option value="perempuan">Perempuan</option>
    </select>
  </div>
</div>

<!-- Row 4: Status Perkawinan dan No. HP -->
<div class="form-row">
  <div class="form-group">
    <label for="status-perkawinan">Waktu Perpindahan</label>
    <select id="status-perkawinan" name="status-perkawinan">
        <option value="Pindah sementara" selected>Pindah sementara</option>
        <option value="Pindah Permanen">Pindah Permanen</option>
    </select>
  </div>

  <div class="form-group">
    <label for="no-hp">No. HP</label>
    <input type="text" id="no-hp" name="no-hp" maxlength="13" placeholder="Masukkan No. HP">
  </div>
</div>




<!-- Row 5: Pendidikan, Pekerjaan, dan Alamat -->
<div class="form-row">
  <div class="form-group">
    <label for="pendidikan">Alasan perpindahan</label>
    <select id="pendidikan" name="pendidikan" required>
        <option value="pekerjaan" selected>Pekerjaan</option>
        <option value="pendidikan">Pendidikan</option>
        <option value="keluarga">Keluarga</option>
        <option value="kesehatan">Kesehatan</option>
        <option value="keamanan">Keamanan atau Bencana Alam</option>
        <option value="lingkungan">Lingkungan atau Kualitas Hidup</option>
        <option value="keagamaan">perpindahan Keagamaan</option>
        <option value="lainnya">Lainnya</option>
    </select>
</div>

  <div class="form-group">
    <label for="pekerjaan">Pekerjaan</label>
    <input type="text" id="pekerjaan" name="pekerjaan"placeholder="Pekerjaan" type="text" required>
  </div>
</div>

<div class="form-group">
    <label for="alamat">Alamat Lama</label>
    <textarea id="alamat" name="alamat"></textarea>
  </div>

<div class="section-title">Alamat Tujuan:</div>
<div class="form-row">
  <div class="form-group">
    <label for="provinsi">Provinsi</label>
    <select id="provinsi" name="provinsi" onchange="loadRegencies(this.value)">
      <option value="" selected>Pilih Provinsi</option>
    </select>
  </div>
  <div class="form-group">
    <label for="kabupaten">Kabupaten/Kota</label>
    <select id="kabupaten" name="kabupaten" onchange="loadDistricts(this.value)">
      <option value="" selected>Pilih Kabupaten/Kota</option>
    </select>
  </div>
</div>
<div class="form-row">
  <div class="form-group">
    <label for="kecamatan">Kecamatan</label>
    <select id="kecamatan" name="kecamatan" onchange="loadVillages(this.value)">
      <option value="" selected>Pilih Kecamatan</option>
    </select>
  </div>
  <div class="form-group">
    <label for="desa">Desa/Kelurahan</label>
    <select id="desa" name="desa">
      <option value="" selected>Pilih Desa/Kelurahan</option>
    </select>
  </div>
</div>

<div class="form-group">
  <label for="alamat-lengkap">Alamat Lengkap</label>
  <textarea id="alamat-lengkap" name="alamat-lengkap"></textarea>
</div>


<!-- Kontainer untuk anggota keluarga -->
<div id="anggota-keluarga-container"></div>



          <div class="form-buttons">

            <button class="btnn-back" onclick="saveAndEdit()">Simpan dan Edit</button>
        </div>
      
        
        </div>
        </div>
        
      </div>
    </div>
  </div>



    <script>
      // Fungsi untuk memperbarui gambar
function updateImage(fileInputId, imagePreviewId, storageKey) {
    const fileInput = document.getElementById(fileInputId);
    const file = fileInput.files[0];

    if (file) {
        const reader = new FileReader();

        reader.onload = function (event) {
            // Perbarui gambar di elemen <img>
            const imagePreview = document.getElementById(imagePreviewId);
            imagePreview.src = event.target.result;

            // Simpan gambar baru ke sessionStorage
            sessionStorage.setItem(storageKey, event.target.result);
        };

        reader.readAsDataURL(file);
    }
}

  // Mendapatkan elemen input berdasarkan id
  const noHpInput = document.getElementById('no-hp');

  // Event listener untuk menangani input pada kolom no_hp
  noHpInput.addEventListener('input', function() {
    // Hanya biarkan angka yang dapat dimasukkan
    this.value = this.value.replace(/[^0-9]/g, ''); // Menghapus karakter selain angka
  });
  


// Fungsi untuk memuat provinsi dan dropdown terkait
async function loadProvinces() {
    try {
        const response = await fetch(
            'https://api.allorigins.win/raw?url=https://emsifa.github.io/api-wilayah-indonesia/api/provinces.json'
        );
        const provinces = await response.json();
        const provinsiSelect = document.getElementById('provinsi');

        // Reset opsi
        provinsiSelect.innerHTML = '<option value="" selected>Pilih Provinsi</option>';
        provinces.forEach(province => {
            const option = document.createElement('option');
            option.value = province.id;
            option.textContent = province.name;
            provinsiSelect.appendChild(option);
        });

        // Pilih provinsi dari sessionStorage jika ada
        const storedProvinceId = sessionStorage.getItem('provinsi');
        if (storedProvinceId) {
            provinsiSelect.value = storedProvinceId;
            await loadRegencies(storedProvinceId); // Muat kabupaten terkait
        }

        // Event listener untuk memuat kabupaten
        provinsiSelect.addEventListener('change', function () {
            loadRegencies(this.value); // Memuat kabupaten berdasarkan provinsi yang dipilih
        });
    } catch (error) {
        console.error('Error loading provinces:', error);
    }
}

async function loadRegencies(provinceId) {
    if (!provinceId) return;
    try {
        const response = await fetch(
            `https://api.allorigins.win/raw?url=https://emsifa.github.io/api-wilayah-indonesia/api/regencies/${provinceId}.json`
        );
        const regencies = await response.json();
        const kabupatenSelect = document.getElementById('kabupaten');

        // Reset opsi
        kabupatenSelect.innerHTML = '<option value="" selected>Pilih Kabupaten/Kota</option>';
        regencies.forEach(regency => {
            const option = document.createElement('option');
            option.value = regency.id;
            option.textContent = regency.name;
            kabupatenSelect.appendChild(option);
        });

        // Pilih kabupaten dari sessionStorage jika ada
        const storedRegencyId = sessionStorage.getItem('kabupaten');
        if (storedRegencyId) {
            kabupatenSelect.value = storedRegencyId;
            await loadDistricts(storedRegencyId); // Muat kecamatan terkait
        }

        // Event listener untuk memuat kecamatan
        kabupatenSelect.addEventListener('change', function () {
            loadDistricts(this.value); // Memuat kecamatan berdasarkan kabupaten yang dipilih
        });
    } catch (error) {
        console.error('Error loading regencies:', error);
    }
}

async function loadDistricts(regencyId) {
    if (!regencyId) return;
    try {
        const response = await fetch(
            `https://api.allorigins.win/raw?url=https://emsifa.github.io/api-wilayah-indonesia/api/districts/${regencyId}.json`
        );
        const districts = await response.json();
        const kecamatanSelect = document.getElementById('kecamatan');

        // Reset opsi
        kecamatanSelect.innerHTML = '<option value="" selected>Pilih Kecamatan</option>';
        districts.forEach(district => {
            const option = document.createElement('option');
            option.value = district.id;
            option.textContent = district.name;
            kecamatanSelect.appendChild(option);
        });

        // Pilih kecamatan dari sessionStorage jika ada
        const storedDistrictId = sessionStorage.getItem('kecamatan');
        if (storedDistrictId) {
            kecamatanSelect.value = storedDistrictId;
            await loadVillages(storedDistrictId); // Muat desa terkait
        }

        // Event listener untuk memuat desa
        kecamatanSelect.addEventListener('change', function () {
            loadVillages(this.value); // Memuat desa berdasarkan kecamatan yang dipilih
        });
    } catch (error) {
        console.error('Error loading districts:', error);
    }
}

async function loadVillages(districtId) {
    if (!districtId) return;
    try {
        const response = await fetch(
            `https://api.allorigins.win/raw?url=https://emsifa.github.io/api-wilayah-indonesia/api/villages/${districtId}.json`
        );
        const villages = await response.json();
        const desaSelect = document.getElementById('desa');

        // Reset opsi
        desaSelect.innerHTML = '<option value="" selected>Pilih Desa/Kelurahan</option>';
        villages.forEach(village => {
            const option = document.createElement('option');
            option.value = village.id;
            option.textContent = village.name;
            desaSelect.appendChild(option);
        });

        // Pilih desa dari sessionStorage jika ada
        const storedVillageId = sessionStorage.getItem('desa');
        if (storedVillageId) {
            desaSelect.value = storedVillageId;
        }
    } catch (error) {
        console.error('Error loading villages:', error);
    }
}

// Fungsi untuk memuat dan menampilkan gambar dari sessionStorage
function preloadImages() {
    const imageFields = [
        { id: 'kk-preview-output', key: 'kk-preview-img' },
        { id: 'house-preview-output', key: 'house-preview-img' }
    ];

    imageFields.forEach(({ id, key }) => {
        const imageData = sessionStorage.getItem(key);
        if (imageData) {
            document.getElementById(id).src = imageData;
        }
    });
}


    // Fungsi untuk menampilkan anggota keluarga dalam format baru dengan fitur edit
    function tampilkanAnggotaKeluarga() {
        const anggotaKeluarga = JSON.parse(sessionStorage.getItem('anggotaKeluarga')) || [];
        const anggotaKeluargaContainer = document.getElementById("anggota-keluarga-container");
    
        if (anggotaKeluarga.length > 0) {
            anggotaKeluarga.forEach((anggota, index) => {
                // Membuat div untuk setiap anggota keluarga
                const anggotaDiv = document.createElement("div");
                anggotaDiv.classList.add("anggota");
    
                // Menyusun HTML dengan format baru dan menambahkan tombol Edit dan Simpan
                anggotaDiv.innerHTML = `
                    <div class="section-title">Anggota Keluarga ${index + 1}:</div>
    
                    <!-- Row 1: NIK dan Nama Lengkap -->
                    <div class="form-row" id="anggota-row-${index + 1}">
                        <div class="form-group">
                            <label for="nik-${index + 1}">NIK</label>
                            <input type="text" id="nik-${index + 1}" name="nik" value="${anggota.nik}" maxlength="16" oninput="validateNumber(this)" onblur="validateLength(this, 16)">
                            <div id="error-message-nik-${index + 1}" style="color: red; display: none;">NIK harus berisi 16 angka.</div>
                        </div>
                        <div class="form-group">
                            <label for="nama-${index + 1}">Nama Lengkap</label>
                            <input type="text" id="nama-${index + 1}" name="nama" value="${anggota.nama}" placeholder="Nama Lengkap" required />
                        </div>
                    </div>
    
                    <!-- Row 2: Status dalam Keluarga dan Pekerjaan -->
                    <div class="form-row" id="anggota-row-${index + 1}-2">
                        <div class="form-group">
                            <label for="status-keluarga-${index + 1}">Status dalam Keluarga</label>
                            <select id="status-keluarga-${index + 1}" name="status-keluarga">
                                <option value="istri" ${anggota.hubungan === 'istri' ? 'selected' : ''}>Istri</option>
                                <option value="anak" ${anggota.hubungan === 'anak' ? 'selected' : ''}>Anak</option>
                                <option value="orang_tua" ${anggota.hubungan === 'orang_tua' ? 'selected' : ''}>Orang Tua</option>
                                <option value="saudara" ${anggota.hubungan === 'saudara' ? 'selected' : ''}>Saudara</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="pekerjaan-${index + 1}">Pekerjaan</label>
                            <input type="text" id="pekerjaan-${index + 1}" name="pekerjaan" value="${anggota.pekerjaan}" maxlength="16" />
                        </div>
                    </div>
    
                `;
    
                // Menambahkan div anggota keluarga ke dalam kontainer
                anggotaKeluargaContainer.appendChild(anggotaDiv);
            });
        } else {
            anggotaKeluargaContainer.innerHTML = "<p></p>";
        }
    }
    
    // Fungsi untuk menyimpan perubahan anggota keluarga
    function simpanPerubahan(index) {
        // Ambil nilai dari input dan select
        const nik = document.getElementById(`nik-${index + 1}`).value;
        const nama = document.getElementById(`nama-${index + 1}`).value;
        const statusKeluarga = document.getElementById(`status-keluarga-${index + 1}`).value;
        const pekerjaan = document.getElementById(`pekerjaan-${index + 1}`).value;
    
        // Ambil data anggota keluarga yang sudah ada dari sessionStorage
        const anggotaKeluarga = JSON.parse(sessionStorage.getItem('anggotaKeluarga')) || [];
    
        // Update data anggota keluarga yang sesuai dengan index
        anggotaKeluarga[index] = {
            nik: nik,
            nama: nama,
            hubungan: statusKeluarga,
            pekerjaan: pekerjaan
        };
    
        // Simpan kembali data yang sudah diperbarui ke sessionStorage
        sessionStorage.setItem('anggotaKeluarga', JSON.stringify(anggotaKeluarga));
    
    }
    
    function saveFormData() {
    const formFields = [
        { id: 'nik', key: 'nik' },
        { id: 'nama', key: 'nama_lengkap' },
        { id: 'no-kk', key: 'no_kk' },
        { id: 'status-keluarga', key: 'status_keluarga' },
        { id: 'agama', key: 'agama' },
        { id: 'jenis-kelamin', key: 'jenis_kelamin' },
        { id: 'status-perkawinan', key: 'status_perkawinan' },
        { id: 'no-hp', key: 'no_hp' },
        { id: 'pendidikan', key: 'pendidikan' },
        { id: 'pekerjaan', key: 'pekerjaan' },
        { id: 'provinsi', key: 'provinsi' },
        { id: 'kabupaten', key: 'kabupaten' },
        { id: 'kecamatan', key: 'kecamatan' },
        { id: 'desa', key: 'desa' },
        { id: 'alamat-lengkap', key: 'alamat_lengkap' },
        { id: 'alamat', key: 'alamat' }  // Alamat Tinggal
    ];

    // Menyimpan data form utama
    formFields.forEach(({ id, key }) => {
        const element = document.getElementById(id);
        if (element) {
            if (element.tagName === 'SELECT') {
                sessionStorage.setItem(key, element.value);
            } else {
                sessionStorage.setItem(key, element.value);
            }
        }
    });

    // Menyimpan data anggota keluarga
    const anggotaKeluarga = [];
    const anggotaCount = document.getElementById('anggota-keluarga-container').childElementCount;

    // Loop untuk mendapatkan data dari setiap anggota keluarga yang ada di form
    for (let i = 0; i < anggotaCount; i++) {
        const nik = document.getElementById(`nik-${i + 1}`).value;
        const nama = document.getElementById(`nama-${i + 1}`).value;
        const statusKeluarga = document.getElementById(`status-keluarga-${i + 1}`).value;
        const pekerjaan = document.getElementById(`pekerjaan-${i + 1}`).value;

        // Menambahkan data anggota keluarga ke array
        anggotaKeluarga.push({
            nik: nik,
            nama: nama,
            hubungan: statusKeluarga,
            pekerjaan: pekerjaan
        });
    }

    // Menyimpan data anggota keluarga ke sessionStorage
    sessionStorage.setItem('anggotaKeluarga', JSON.stringify(anggotaKeluarga));

}

    
window.onload = async function () {
    const formFields = [
        { id: 'nik', key: 'nik' },
        { id: 'nama', key: 'nama_lengkap' },
        { id: 'no-kk', key: 'no_kk' },
        { id: 'status-keluarga', key: 'status_keluarga' },
        { id: 'agama', key: 'agama' },
        { id: 'jenis-kelamin', key: 'jenis_kelamin' },
        { id: 'status-perkawinan', key: 'status_perkawinan' },
        { id: 'no-hp', key: 'no_hp' },
        { id: 'pendidikan', key: 'pendidikan' },
        { id: 'pekerjaan', key: 'pekerjaan' },
        { id: 'provinsi', key: 'provinsi' },
        { id: 'kabupaten', key: 'kabupaten' },
        { id: 'kecamatan', key: 'kecamatan' },
        { id: 'desa', key: 'desa' },
        { id: 'alamat-lengkap', key: 'alamat_lengkap' },
        { id: 'alamat', key: 'alamat' }  // Alamat Tinggal
    ];

    // Preload data dari sessionStorage
    formFields.forEach(({ id, key }) => {
        const value = sessionStorage.getItem(key);
        if (value) {
            const element = document.getElementById(id);
            if (element.tagName === 'SELECT') {
                Array.from(element.options).forEach(option => {
                    if (option.value === value) {
                        option.selected = true;
                    }
                });
            } else {
                element.value = value;
            }
        }
    });

    // Preload gambar dari sessionStorage
    preloadImages();

    // Memuat data provinsi dan dropdown berantai
    await loadProvinces();

    // Menampilkan data anggota keluarga setelah halaman dimuat
    tampilkanAnggotaKeluarga();
};

// Fungsi untuk menyimpan dan mengedit data
function saveAndEdit() {
    const userConfirmed = confirm("Apakah Anda yakin ingin mengedit data?");
    if (userConfirmed) {
        saveFormData(); // Simpan semua data form (termasuk anggota keluarga)
        window.location.href = "outputkme.html"; // Alihkan ke halaman output1.html
    } else {
        alert("Edit data dibatalkan.");
    }
}


// Fungsi untuk menghapus semua data
function resetFormData() {
    sessionStorage.clear();
    alert('Data telah direset!');
    location.reload();
}
// Fungsi untuk memastikan input hanya angka
function validateNumber(input) {
    input.value = input.value.replace(/[^0-9]/g, ''); // Hapus karakter non-angka
    validateLength(input, 16);  // Validasi panjang setelah input
}

// Fungsi untuk memastikan panjang input sesuai
function validateLength(input, length) {
    // Mengambil elemen error berdasarkan ID input
    const errorMessage = document.getElementById('error-message-' + input.id); // Dinamis menggunakan input.id
    
    // Jika panjang input tidak sesuai dengan panjang yang diinginkan
    if (input.value.length !== length) {
        errorMessage.style.display = 'block';  // Tampilkan pesan kesalahan
    } else {
        errorMessage.style.display = 'none';  // Sembunyikan pesan kesalahan jika valid
    }
}


    </script>

</body>
</html>
